<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Input Data Anak - Sistem Informasi Posyandu</title>
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Bootstrap Icons -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css"
    />
    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap"
      rel="stylesheet"
    />
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/assets/css/styles.css" />
  </head>
  <body id="nav-section">
    <!-- Navbar -->
    <nav
      class="navbar navbar-expand-lg navbar-dark fixed-top"
      style="
        background: var(--gradient-primary);
        box-shadow: var(--shadow-medium);
      "
    >
      <div class="container-fluid">
        <a class="navbar-brand mx-auto mx-lg-0 text-white" href="/index.html">
          <i class="bi bi-heart-pulse-fill me-2"></i>SI-Posyandu
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle text-white d-flex align-items-center"
                href="#"
                role="button"
                data-bs-toggle="dropdown"
              >
                <img
                  src="https://ui-avatars.com/api/?name=Bidan&background=fff&color=198754"
                  alt="Bidan"
                  class="rounded-circle me-2"
                  width="32"
                />
                <span>Bidan</span>
              </a>
              <ul class="dropdown-menu dropdown-menu-end border-0 shadow-lg">
                <li>
                  <a class="dropdown-item" href="#">
                    <i class="bi bi-person me-2 text-primary"></i>Profil
                  </a>
                </li>
                <li>
                  <a class="dropdown-item" href="#">
                    <i class="bi bi-gear me-2 text-primary"></i>Pengaturan
                  </a>
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li>
                  <a class="dropdown-item text-danger" href="/auth/login.html">
                    <i class="bi bi-box-arrow-right me-2"></i>Keluar
                  </a>
                </li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <div class="container-fluid" style="padding-top: 70px">
      <div class="row">
        <!-- Sidebar -->
        <div
          class="sidebar col-lg-2 px-0 d-flex flex-column flex-shrink-0"
          style="background: white; box-shadow: var(--shadow-soft)"
        >
          <div class="p-3 border-bottom">
            <div class="text-center">
              <img
                src="https://ui-avatars.com/api/?name=Kader&background=198754&color=fff"
                alt="Kader"
                class="rounded-circle mb-2 border border-3 border-primary"
                width="80"
              />
              <h6 class="mb-0">Nama Kader</h6>
              <small class="text-muted">Kader Posyandu</small>
            </div>
          </div>
          <ul class="nav nav-pills flex-column mb-auto p-3">
            <li class="nav-item mb-2">
              <a
                href="/kader/input-anak.html"
                class="nav-link active rounded-pill"
              >
                <i class="bi bi-person-plus me-2"></i> Data Anak
              </a>
            </li>
            <li class="nav-item mb-2">
              <a
                href="/kader/data-pemeriksaan.html"
                class="nav-link rounded-pill"
              >
                <i class="bi bi-table me-2"></i> Data Pemeriksaan
              </a>
            </li>
            <li class="nav-item mt-4">
              <a
                href="/auth/login.html"
                class="nav-link text-danger rounded-pill"
              >
                <i class="bi bi-box-arrow-left me-2"></i> Keluar
              </a>
            </li>
          </ul>
        </div>

        <!-- Main Content -->
        <main class="col-lg-10 ms-auto content-wrapper">
          <div class="container-fluid px-4">
            <h1 class="mt-2 mb-4">Data Anak</h1>
            <div class="d-flex justify-content-end mb-4">
              <button
                class="btn btn-success"
                data-bs-toggle="modal"
                data-bs-target="#childFormModal"
                onclick="openAddModal()"
              >
                <i class="bi bi-plus-circle me-2"></i>Tambah Data Anak
              </button>
            </div>

            <!-- data anak -->
            <div class="card mb-4">
              <div class="card-header bg-light">
                <h5 class="mb-0">Data Anak Terbaru</h5>
              </div>
              <div class="card-body">
                <div class="table-responsive">
                  <table class="table table-hover table-striped">
                    <thead>
                      <tr>
                        <th>No</th>
                        <th>Nama Anak</th>
                        <th>NIK</th>
                        <th>Tanggal Lahir</th>
                        <th>Jenis Kelamin</th>
                        <th>Nama Ibu</th>
                        <th>Aksi</th>
                      </tr>
                    </thead>
                    <tbody id="childTableBody">
                      <!-- Data akan dimuat oleh JavaScript -->
                    </tbody>
                  </table>
                </div>
              </div>
              <div class="card-footer text-center">
                <a
                  href="/kader/laporan-anak.html"
                  class="btn btn-sm btn-outline-secondary"
                >
                  Lihat Semua Data
                </a>
              </div>
            </div>
          </div>

          <!-- Modal Popup Form Tambah/Edit Data -->
          <div
            class="modal fade"
            id="childFormModal"
            tabindex="-1"
            aria-labelledby="childFormModalLabel"
            aria-hidden="true"
          >
            <div class="modal-dialog modal-lg">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="childFormModalLabel">
                    Formulir Data Anak
                  </h5>
                  <button
                    type="button"
                    class="btn-close"
                    data-bs-dismiss="modal"
                    aria-label="Close"
                  ></button>
                </div>
                <div class="modal-body">
                  <form id="childForm" class="needs-validation" novalidate>
                    <input type="hidden" id="childId" />
                    <div class="row g-3">
                      <div class="col-md-6">
                        <label for="childName" class="form-label"
                          >Nama Anak <span class="text-danger">*</span></label
                        >
                        <input
                          type="text"
                          class="form-control"
                          id="childName"
                          required
                        />
                        <div class="invalid-feedback">
                          Nama anak wajib diisi.
                        </div>
                      </div>
                      <div class="col-md-6">
                        <label for="childNIK" class="form-label"
                          >NIK <span class="text-danger">*</span></label
                        >
                        <input
                          type="text"
                          class="form-control"
                          id="childNIK"
                          required
                        />
                        <div class="invalid-feedback">NIK wajib diisi.</div>
                      </div>
                      <div class="col-md-6">
                        <label for="birthDate" class="form-label"
                          >Tanggal Lahir
                          <span class="text-danger">*</span></label
                        >
                        <input
                          type="date"
                          class="form-control"
                          id="birthDate"
                          required
                        />
                        <div class="invalid-feedback">
                          Tanggal lahir wajib diisi.
                        </div>
                      </div>
                      <div class="col-md-6">
                        <label for="gender" class="form-label"
                          >Jenis Kelamin
                          <span class="text-danger">*</span></label
                        >
                        <select class="form-select" id="gender" required>
                          <option value="" selected disabled>Pilih...</option>
                          <option value="L">Laki-laki</option>
                          <option value="P">Perempuan</option>
                        </select>
                        <div class="invalid-feedback">
                          Jenis kelamin wajib dipilih.
                        </div>
                      </div>

                      <div class="col-12 mt-3">
                        <h5 class="border-bottom pb-2">Data Orang Tua</h5>
                      </div>

                      <div class="col-md-6">
                        <label for="fatherName" class="form-label"
                          >Nama Ayah <span class="text-danger">*</span></label
                        >
                        <input
                          type="text"
                          class="form-control"
                          id="fatherName"
                          required
                        />
                        <div class="invalid-feedback">
                          Nama ayah wajib diisi.
                        </div>
                      </div>
                      <div class="col-md-6">
                        <label for="motherName" class="form-label"
                          >Nama Ibu <span class="text-danger">*</span></label
                        >
                        <input
                          type="text"
                          class="form-control"
                          id="motherName"
                          required
                        />
                        <div class="invalid-feedback">
                          Nama ibu wajib diisi.
                        </div>
                      </div>
                      <div class="col-md-6">
                        <label for="phoneNumber" class="form-label"
                          >Nomor Telepon</label
                        >
                        <input
                          type="tel"
                          class="form-control"
                          id="phoneNumber"
                        />
                      </div>
                      <div class="col-12">
                        <label for="address" class="form-label"
                          >Alamat <span class="text-danger">*</span></label
                        >
                        <textarea
                          class="form-control"
                          id="address"
                          rows="2"
                          required
                        ></textarea>
                        <div class="invalid-feedback">Alamat wajib diisi.</div>
                      </div>

                      <div class="col-md-4">
                        <label for="village" class="form-label"
                          >Desa/Kelurahan
                          <span class="text-danger">*</span></label
                        >
                        <input
                          type="text"
                          class="form-control"
                          id="village"
                          required
                        />
                        <div class="invalid-feedback">
                          Desa/Kelurahan wajib diisi.
                        </div>
                      </div>
                      <div class="col-md-4">
                        <label for="district" class="form-label"
                          >Kecamatan <span class="text-danger">*</span></label
                        >
                        <input
                          type="text"
                          class="form-control"
                          id="district"
                          required
                        />
                        <div class="invalid-feedback">
                          Kecamatan wajib diisi.
                        </div>
                      </div>
                      <div class="col-md-4">
                        <label for="postalCode" class="form-label"
                          >Kode Pos</label
                        >
                        <input
                          type="text"
                          class="form-control"
                          id="postalCode"
                        />
                      </div>
                    </div>
                  </form>
                </div>
                <div class="modal-footer">
                  <button
                    type="button"
                    class="btn btn-secondary"
                    data-bs-dismiss="modal"
                  >
                    <i class="bi bi-x-circle me-2"></i>Tutup
                  </button>
                  <button
                    type="submit"
                    form="childForm"
                    class="btn btn-posyandu"
                  >
                    <i class="bi bi-save me-2"></i>Simpan Data
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Modal Detail Data Anak -->
          <div
            class="modal fade"
            id="childDetailModal"
            tabindex="-1"
            aria-labelledby="childDetailModalLabel"
            aria-hidden="true"
          >
            <div class="modal-dialog modal-lg">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="childDetailModalLabel">
                    Detail Data Anak
                  </h5>
                  <button
                    type="button"
                    class="btn-close"
                    data-bs-dismiss="modal"
                    aria-label="Close"
                  ></button>
                </div>
                <div class="modal-body">
                  <div class="row">
                    <div class="col-12">
                      <h6 class="border-bottom pb-2 mb-3">Data Anak</h6>
                    </div>
                    <div class="col-md-6">
                      <div class="detail-row">
                        <span class="detail-label">Nama Anak:</span>
                        <span id="detailChildName"></span>
                      </div>
                      <div class="detail-row">
                        <span class="detail-label">NIK:</span>
                        <span id="detailChildNIK"></span>
                      </div>
                      <div class="detail-row">
                        <span class="detail-label">Tanggal Lahir:</span>
                        <span id="detailBirthDate"></span>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="detail-row">
                        <span class="detail-label">Jenis Kelamin:</span>
                        <span id="detailGender"></span>
                      </div>
                      <div class="detail-row">
                        <span class="detail-label">Umur:</span>
                        <span id="detailAge"></span>
                      </div>
                    </div>
                  </div>

                  <div class="row mt-4">
                    <div class="col-12">
                      <h6 class="border-bottom pb-2 mb-3">Data Orang Tua</h6>
                    </div>
                    <div class="col-md-6">
                      <div class="detail-row">
                        <span class="detail-label">Nama Ayah:</span>
                        <span id="detailFatherName"></span>
                      </div>
                      <div class="detail-row">
                        <span class="detail-label">Nama Ibu:</span>
                        <span id="detailMotherName"></span>
                      </div>
                      <div class="detail-row">
                        <span class="detail-label">Nomor Telepon:</span>
                        <span id="detailPhoneNumber"></span>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="detail-row">
                        <span class="detail-label">Alamat:</span>
                        <span id="detailAddress"></span>
                      </div>
                      <div class="detail-row">
                        <span class="detail-label">Desa/Kelurahan:</span>
                        <span id="detailVillage"></span>
                      </div>
                      <div class="detail-row">
                        <span class="detail-label">Kecamatan:</span>
                        <span id="detailDistrict"></span>
                      </div>
                      <div class="detail-row">
                        <span class="detail-label">Kode Pos:</span>
                        <span id="detailPostalCode"></span>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="modal-footer">
                  <button
                    type="button"
                    class="btn btn-secondary"
                    data-bs-dismiss="modal"
                  >
                    <i class="bi bi-x-circle me-2"></i>Tutup
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Modal Konfirmasi Hapus -->
          <div
            class="modal fade"
            id="deleteConfirmModal"
            tabindex="-1"
            aria-labelledby="deleteConfirmModalLabel"
            aria-hidden="true"
          >
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="deleteConfirmModalLabel">
                    Konfirmasi Hapus
                  </h5>
                  <button
                    type="button"
                    class="btn-close"
                    data-bs-dismiss="modal"
                    aria-label="Close"
                  ></button>
                </div>
                <div class="modal-body">
                  <p>
                    Apakah Anda yakin ingin menghapus data anak
                    <strong id="deleteChildName"></strong>?
                  </p>
                  <p class="text-muted">
                    Data yang sudah dihapus tidak dapat dikembalikan.
                  </p>
                </div>
                <div class="modal-footer">
                  <button
                    type="button"
                    class="btn btn-secondary"
                    data-bs-dismiss="modal"
                  >
                    <i class="bi bi-x-circle me-2"></i>Batal
                  </button>
                  <button
                    type="button"
                    class="btn btn-danger"
                    id="confirmDeleteBtn"
                  >
                    <i class="bi bi-trash me-2"></i>Hapus
                  </button>
                </div>
              </div>
            </div>
          </div>
        </main>
      </div>
    </div>

    <!-- Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Custom JS -->
    <script src="/assets/js/scripts.js"></script>

    <!-- data dummy -->
    <script>
      let childrenData = [
        {
          id: 1,
          name: "Dina Maulida",
          nik: "3502160309202304",
          birthDate: "2023-09-03",
          gender: "P",
          fatherName: "Ahmad Maulana",
          motherName: "Nur Aini",
          phoneNumber: "081234567890",
          address: "Jl. Melati No. 15",
          village: "Sukarame",
          district: "Kediri",
          postalCode: "64123",
        },
        {
          id: 2,
          name: "Budi Santoso",
          nik: "3502162207202203",
          birthDate: "2022-07-22",
          gender: "L",
          fatherName: "Santoso",
          motherName: "Sri Wahyuni",
          phoneNumber: "081987654321",
          address: "Jl. Anggrek No. 8",
          village: "Mojoroto",
          district: "Kediri",
          postalCode: "64117",
        },
      ];

      let isEditing = false;
      let editingId = null;
      let deleteId = null;

      // Fungsi untuk menghitung umur
      function calculateAge(birthDate) {
        const today = new Date();
        const birth = new Date(birthDate);
        let age = today.getFullYear() - birth.getFullYear();
        const monthDiff = today.getMonth() - birth.getMonth();

        if (
          monthDiff < 0 ||
          (monthDiff === 0 && today.getDate() < birth.getDate())
        ) {
          age--;
        }

        return age;
      }

      // Fungsi untuk memformat tanggal
      function formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString("id-ID", {
          day: "2-digit",
          month: "2-digit",
          year: "numeric",
        });
      }

      // Fungsi untuk memuat data ke tabel
      function loadChildrenData() {
        const tbody = document.getElementById("childTableBody");
        tbody.innerHTML = "";

        childrenData.forEach((child, index) => {
          const row = document.createElement("tr");
          row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${child.name}</td>
                    <td>${child.nik}</td>
                    <td>${formatDate(child.birthDate)}</td>
                    <td>${child.gender === "L" ? "Laki-laki" : "Perempuan"}</td>
                    <td>${child.motherName}</td>
                    <td class="action-buttons">
                        <button class="btn btn-sm btn-info" onclick="viewChild(${
                          child.id
                        })" title="Lihat Detail">
                            <i class="bi bi-eye"></i>
                        </button>
                        <button class="btn btn-sm btn-warning" onclick="editChild(${
                          child.id
                        })" title="Edit">
                            <i class="bi bi-pencil"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteChild(${
                          child.id
                        })" title="Hapus">
                            <i class="bi bi-trash"></i>
                        </button>
                    </td>
                `;
          tbody.appendChild(row);
        });
      }

      // Fungsi untuk membuka modal tambah data
      function openAddModal() {
        isEditing = false;
        editingId = null;
        document.getElementById("childFormModalLabel").textContent =
          "Tambah Data Anak";
        document.getElementById("childForm").reset();
        document.getElementById("childForm").classList.remove("was-validated");
      }

      // Fungsi untuk melihat detail anak
      function viewChild(id) {
        const child = childrenData.find((c) => c.id === id);
        if (child) {
          document.getElementById("detailChildName").textContent = child.name;
          document.getElementById("detailChildNIK").textContent = child.nik;
          document.getElementById("detailBirthDate").textContent = formatDate(
            child.birthDate
          );
          document.getElementById("detailGender").textContent =
            child.gender === "L" ? "Laki-laki" : "Perempuan";
          document.getElementById("detailAge").textContent =
            calculateAge(child.birthDate) + " tahun";
          document.getElementById("detailFatherName").textContent =
            child.fatherName;
          document.getElementById("detailMotherName").textContent =
            child.motherName;
          document.getElementById("detailPhoneNumber").textContent =
            child.phoneNumber || "-";
          document.getElementById("detailAddress").textContent = child.address;
          document.getElementById("detailVillage").textContent = child.village;
          document.getElementById("detailDistrict").textContent =
            child.district;
          document.getElementById("detailPostalCode").textContent =
            child.postalCode || "-";

          const modal = new bootstrap.Modal(
            document.getElementById("childDetailModal")
          );
          modal.show();
        }
      }

      // Fungsi untuk edit anak
      function editChild(id) {
        const child = childrenData.find((c) => c.id === id);
        if (child) {
          isEditing = true;
          editingId = id;
          document.getElementById("childFormModalLabel").textContent =
            "Edit Data Anak";

          // Isi form dengan data yang akan diedit
          document.getElementById("childId").value = child.id;
          document.getElementById("childName").value = child.name;
          document.getElementById("childNIK").value = child.nik;
          document.getElementById("birthDate").value = child.birthDate;
          document.getElementById("gender").value = child.gender;
          document.getElementById("fatherName").value = child.fatherName;
          document.getElementById("motherName").value = child.motherName;
          document.getElementById("phoneNumber").value = child.phoneNumber;
          document.getElementById("address").value = child.address;
          document.getElementById("village").value = child.village;
          document.getElementById("district").value = child.district;
          document.getElementById("postalCode").value = child.postalCode;

          const modal = new bootstrap.Modal(
            document.getElementById("childFormModal")
          );
          modal.show();
        }
      }

      // Fungsi untuk hapus anak
      function deleteChild(id) {
        const child = childrenData.find((c) => c.id === id);
        if (child) {
          deleteId = id;
          document.getElementById("deleteChildName").textContent = child.name;
          const modal = new bootstrap.Modal(
            document.getElementById("deleteConfirmModal")
          );
          modal.show();
        }
      }

      // Event listener untuk konfirmasi hapus
      document
        .getElementById("confirmDeleteBtn")
        .addEventListener("click", function () {
          if (deleteId) {
            childrenData = childrenData.filter((c) => c.id !== deleteId);
            loadChildrenData();

            const modal = bootstrap.Modal.getInstance(
              document.getElementById("deleteConfirmModal")
            );
            modal.hide();

            // Tampilkan notifikasi sukses
            alert("Data anak berhasil dihapus!");
            deleteId = null;
          }
        });

      // Event listener untuk form submit
      document
        .getElementById("childForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          if (this.checkValidity()) {
            const formData = {
              name: document.getElementById("childName").value,
              nik: document.getElementById("childNIK").value,
              birthDate: document.getElementById("birthDate").value,
              gender: document.getElementById("gender").value,
              fatherName: document.getElementById("fatherName").value,
              motherName: document.getElementById("motherName").value,
              phoneNumber: document.getElementById("phoneNumber").value,
              address: document.getElementById("address").value,
              village: document.getElementById("village").value,
              district: document.getElementById("district").value,
              postalCode: document.getElementById("postalCode").value,
            };

            if (isEditing && editingId) {
              // Update data yang sudah ada
              const index = childrenData.findIndex((c) => c.id === editingId);
              if (index !== -1) {
                childrenData[index] = { ...childrenData[index], ...formData };
              }
              alert("Data anak berhasil diupdate!");
            } else {
              // Tambah data baru
              const newId = Math.max(...childrenData.map((c) => c.id), 0) + 1;
              childrenData.push({ id: newId, ...formData });
              alert("Data anak berhasil ditambahkan!");
            }

            // Reset form dan tutup modal
            this.reset();
            this.classList.remove("was-validated");
            const modal = bootstrap.Modal.getInstance(
              document.getElementById("childFormModal")
            );
            modal.hide();

            // Reload data tabel
            loadChildrenData();
          }

          this.classList.add("was-validated");
        });

      // Muat data saat halaman dimuat
      document.addEventListener("DOMContentLoaded", function () {
        loadChildrenData();
      });
    </script>
  </body>
</html>
